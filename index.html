<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SDO Mandaluyong Request Slip Form</title>
    <style>
        /* --- CORE DESIGN (FROM CODE A) --- */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Georgia', serif;
            background-color: #f0f4f8;
            background-image: url('1920 x 1080.png');  
            background-position: 50% 10%;
            background-repeat: no-repeat;
            background-size: cover;
            display: flex; justify-content: center; align-items: center; padding: 20px;
            overflow-x: hidden; min-height: 100vh;
        }
        .container { background: white; border-radius: 30px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); max-width: 800px; width: 100%; overflow: hidden; position: relative; z-index: 10; margin: 0 auto; }
        .header { background: linear-gradient(135deg, #4a90e2 0%, #357abd 100%); padding: 25px 30px; text-align: center; position: relative; border-bottom: 4px solid #2563a8; }
        
        /* Header Flex Settings */
        .header-logos { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; gap: 10px; flex-direction: row; }
        .logo-placeholder { width: 80px; height: 80px; background: rgb(255, 255, 255); border-radius: 50%; display: flex; align-items: center; justify-content: center; overflow: hidden; padding: 5px; flex-shrink: 0; }
        .logo-placeholder img { width: 100%; height: 100%; object-fit: contain; }
        .header-text-container { flex: 1; display: flex; flex-direction: column; align-items: center; }
        .header h1 { color: white; font-size: 28px; margin-bottom: 5px; letter-spacing: 2px; line-height: 1.2; }
        .header h2 { color: white; font-size: 20px; font-weight: normal; letter-spacing: 1px; line-height: 1.2; }
       
        /* FORM CONTENT */
        .form-content { padding: 40px 50px; background: rgba(255, 255, 255, 0.98); }
        .form-group { margin-bottom: 25px; }
        label { display: block; margin-bottom: 10px; color: #333; font-weight: normal; font-size: 18px; }
       
        /* INPUT STYLES */
        input[type="text"], input[list], select, input[type="password"], input[type="email"] {
            width: 100%; padding: 15px 10px; border: none; border-bottom: 2px solid #333;
            background: transparent; font-size: 16px; font-family: 'Georgia', serif; transition: border-color 0.3s;
        }
        input[type="text"]:focus, input[list]:focus, select:focus, input[type="password"]:focus, input[type="email"]:focus {
            outline: none; border-bottom-color: #4a90e2;
        }
       
        /* GRID SYSTEMS */
        .row-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .row-4 { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-top: 10px; }
        
        /* CHECKBOXES & RADIO */
        .radio-group { display: flex; gap: 20px; margin-top: 10px; }
        .radio-item, .checkbox-group { display: flex; align-items: center; cursor: pointer; }
        input[type="radio"], input[type="checkbox"] {
            width: 20px; height: 20px; margin-right: 10px; cursor: pointer; accent-color: #4a90e2; margin:5px;
        }
       
        /* SECTIONS */
        .section-box { margin-top: 30px; padding: 25px; background: rgba(240, 248, 255, 0.5); border-radius: 20px; border: 1px solid #e1e8ed; }
        .section-title { color: #333; margin-bottom: 15px; font-size: 20px; font-weight: bold; border-bottom: 1px solid #ccc; padding-bottom: 5px; }
        .subsection-title { color: #4a90e2; font-weight: bold; margin-bottom: 10px; margin-top: 15px; font-size: 16px; text-transform: uppercase; letter-spacing: 1px; }
        .subsection-title.green { color: #27ae60; }
       
        /* BUTTONS */
        .submit-btn {
            width: 250px; padding: 15px; background: white; color: #333; border: 2px solid #333;
            border-radius: 25px; font-size: 18px; cursor: pointer; transition: all 0.3s;
            margin: 40px auto 0; display: block; font-family: 'Georgia', serif;
        }
        .submit-btn:hover { background: #4a90e2; color: white; border-color: #4a90e2; }

        /* FOOTER */
        .footer { background: linear-gradient(to right, #4a90e2, #357abd); color: white; padding: 15px 30px; font-size: 15px; border-top: 3px solid #2563a8; text-align: center; }
        .footer-content { display: flex; justify-content: center; align-items: center; gap: 12px; }
        .footer-icon { font-size: 22px; display: flex; align-items: center; justify-content: center; width: 35px; height: 35px; background: white; border-radius: 50%; color: #4a90e2; }

        /* UTILITIES */
        .hidden { display: none !important; }
        .required { color: #e74c3c; }
        .readonly-field { background-color: transparent; cursor: not-allowed; color: #666; }
       
        /* ANIMATIONS */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fadeIn 0.4s ease-out forwards; }
       
        /* LOGICAL TOGGLES */
        .sub-container { margin-left: 25px; overflow: hidden; transition: max-height 0.3s ease-out; }
        .sub-container.closed { max-height: 0; opacity: 0; }
        .sub-container.open { max-height: 1000px; opacity: 1; }
        .checkbox-row { display: flex; align-items: flex-start; margin-bottom: 8px; }
        .checkbox-label { font-size: 15px; color: #444; cursor: pointer; line-height: 1.4; }

        /* LOGIN SCREEN & MODALS */
        #login-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.95); backdrop-filter: blur(10px); z-index: 9999; display: flex; justify-content: center; align-items: center; }
        .login-box { background: white; padding: 40px; border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.2); width: 100%; max-width: 400px; text-align: center; border: 1px solid #ddd; }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); justify-content: center; align-items: center; z-index: 2000; }
        .modal.active { display: flex; }
        .modal-content { background: white; padding: 40px; border-radius: 20px; text-align: center; max-width: 400px; width: 90%; box-shadow: 0 10px 40px rgba(0,0,0,0.3); }
        .modal-buttons { display: flex; gap: 15px; justify-content: center; margin-top: 20px; }
        .modal-btn { padding: 10px 25px; border-radius: 20px; cursor: pointer; border: 1px solid #ccc; font-family: 'Georgia', serif;}
        .btn-confirm { background: #4a90e2; color: white; border-color: #4a90e2; }
        .btn-cancel { background: white; color: #333; }

        /* MASCOT & CONTACT */
        .mascot-container { position: fixed; bottom: 20px; left: 50px; z-index: 100; display: flex; align-items: flex-end; gap: 10px; }
        .tiger-mascot { width: 100px; height: 100px; background: radial-gradient(circle at 30% 30%, #ff9944, #ff6622); border-radius: 50%; position: relative; box-shadow: 0 10px 30px rgba(0,0,0,0.3); cursor: pointer; animation: float 3s ease-in-out infinite; transition: all 0.3s; display: flex; align-items: center; justify-content: center; }
        .tiger-mascot:hover { animation: bounce 0.6s ease infinite; transform: scale(1.1); }
        @keyframes float { 0%, 100% { transform: translateY(0px); } 50% { transform: translateY(-10px); } }
        @keyframes bounce { 0%, 100% { transform: translateY(0) scale(1.1); } 50% { transform: translateY(-15px) scale(1.1); } }
        .tiger-face { font-size: 50px; animation: wave 2s ease-in-out infinite; }
        .tiger-mascot:hover .tiger-face { animation: wiggle 0.5s ease infinite; }
        @keyframes wave { 0%, 100% { transform: rotate(0deg); } 25% { transform: rotate(-5deg); } 75% { transform: rotate(5deg); } }
        @keyframes wiggle { 0%, 100% { transform: rotate(0deg) scale(1); } 25% { transform: rotate(-10deg) scale(1.1); } 75% { transform: rotate(10deg) scale(1.1); } }
        
        .contact-btn { background: #ffeb3b; color: #333; padding: 15px 30px; border: 3px solid #333; border-radius: 15px 15px 15px 0; font-size: 16px; font-weight: bold; cursor: pointer; box-shadow: 0 5px 15px rgba(0,0,0,0.2); transition: all 0.3s; font-family: 'Georgia', serif; display: none; }
        .contact-btn.show { display: block; animation: slideIn 0.3s ease; }
        @keyframes slideIn { from { opacity: 0; transform: translateX(-20px); } to { opacity: 1; transform: translateX(0); } }
        .contact-btn:hover { background: #fdd835; transform: translateY(-2px); box-shadow: 0 7px 20px rgba(0,0,0,0.3); }
        
        .contact-popup { position: fixed; bottom: 140px; left: 50px; background: white; border: 3px solid #333; border-radius: 15px; padding: 20px 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); z-index: 1000; display: none; min-width: 300px; }
        .contact-popup.show { display: block; animation: popIn 0.3s ease; }
        @keyframes popIn { from { opacity: 0; transform: translateY(20px) scale(0.8); } to { opacity: 1; transform: translateY(0) scale(1); } }
        .contact-popup h3 { color: #4a90e2; margin-bottom: 15px; font-size: 20px; border-bottom: 2px solid #4a90e2; padding-bottom: 10px; }
        .contact-item { display: flex; align-items: center; gap: 12px; margin-bottom: 12px; color: #333; font-size: 15px; }
        .contact-item:last-child { margin-bottom: 0; }
        .contact-icon { font-size: 20px; min-width: 25px; }
        .contact-text a { color: #4a90e2; text-decoration: none; }
        .contact-text a:hover { text-decoration: underline; }
        .close-contact { position: absolute; top: 10px; right: 15px; background: none; border: none; font-size: 24px; cursor: pointer; color: #666; transition: color 0.3s; }
        .close-contact:hover { color: #333; }
        
        .tiger-speech-bubble { position: fixed; bottom: 100px; left: 140px; background: white; color: #333; padding: 12px 18px; border-radius: 20px; border: 3px solid #333; font-size: 14px; font-weight: bold; box-shadow: 0 5px 15px rgba(0,0,0,0.3); z-index: 99; animation: bubbleBounce 2s ease-in-out infinite; display: none; white-space: nowrap; }
        .tiger-speech-bubble.show { display: block; }
        .tiger-speech-bubble::before { content: ''; position: absolute; top: 50%; left: -15px; transform: translateY(-50%); width: 0; height: 0; border-style: solid; border-width: 10px 15px 10px 0; border-color: transparent #333 transparent transparent; }
        .tiger-speech-bubble::after { content: ''; position: absolute; top: 50%; left: -9px; transform: translateY(-50%); width: 0; height: 0; border-style: solid; border-width: 8px 12px 8px 0; border-color: transparent white transparent transparent; }
        @keyframes bubbleBounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-8px); } }

        /* RESPONSIVENESS */
        @media (max-width: 768px) {
            .container { margin: 0 10px; border-radius: 20px; }
            .header-logos { flex-direction: row; gap: 5px; }
            .logo-placeholder { width: 60px; height: 60px; }
            .header h1 { font-size: 18px; letter-spacing: 1px; }
            .header h2 { font-size: 14px; letter-spacing: 0.5px; }
            .row-2, .row-4 { grid-template-columns: 1fr; }
            .mascot-container { left: 20px; bottom: 10px; }
            .tiger-speech-bubble { left: 100px; }
            .contact-popup { left: 50%; transform: translateX(-50%); bottom: 120px; }
            .contact-popup.show { transform: translateX(-50%); }
        }

        @media (max-width: 480px) {
            .logo-placeholder { width: 50px; height: 50px; }
            .header h1 { font-size: 16px; }
            .header h2 { font-size: 12px; }
            .form-content { padding: 25px 20px; }
        }

    </style>
</head>
<body>


    <!-- 1. LOGIN OVERLAY -->
    <div id="login-screen">
        <div class="login-box">
            <div style="margin-bottom: 20px;">
                <img src="DepEd NCR logo.png" alt="Logo" style="width: 80px; height: 80px; object-fit: contain;">
            </div>
            <h2 style="color: #4a90e2; margin-bottom: 10px;">Employee Access</h2>
            <p style="color:#666; margin-bottom:20px;">Please enter the Form Password.</p>
            <form id="loginForm">
                <input type="email" id="loginEmail" placeholder="Email" required style="margin-bottom: 15px;">
                <input type="password" id="loginPassword" placeholder="Password" required style="margin-bottom: 15px;">
                <button type="submit" class="submit-btn" style="width:100%; margin-top:10px;">Unlock Form</button>
            </form>
            <div id="loginError" style="color: red; margin-top: 15px; font-size: 14px;"></div>
        </div>
    </div>


    <!-- 2. MAIN CONTAINER -->
    <div class="container hidden" id="mainContainer">
       
        <!-- HEADER -->
        <div class="header">
            <div class="header-logos">
                <div class="logo-placeholder"><img src="335402378_923523102004407_5287473594018305126_n.jpg" alt="SDO Logo"></div>
                <div class="header-text-container">
                    <h1>SDO MANDALUYONG</h1>
                    <h2>REQUEST SLIP FORM</h2>
                </div>
                <div class="logo-placeholder"><img src="DepEd NCR logo.png" alt="DepEd Logo"></div>
            </div>
        </div>
       
        <div class="form-content">
            <form id="requestForm">
               
                <!-- TRANSACTION TYPE -->
                <div class="section-box" style="margin-top: 0;">
                    <h3 class="section-title">Transaction Details</h3>
                    <p style="margin-bottom: 10px;">Who is conducting this transaction?</p>
                    <div class="radio-group">
                        <label class="radio-item">
                            <input type="radio" name="transactionType" value="myself" checked onclick="toggleRepresentative(false)">
                            Myself (Document Owner)
                        </label>
                        <label class="radio-item">
                            <input type="radio" name="transactionType" value="representative" onclick="toggleRepresentative(true)">
                            Authorized Representative
                        </label>
                    </div>

                    <div id="representativeFields" class="hidden animate-fade-in" style="margin-top: 20px; border-top: 1px dashed #ccc; padding-top: 15px;">
                        <div class="row-2">
                            <div><label>Representative Name:</label><input type="text" id="representativeName"></div>
                            <div><label>Relationship:</label><input type="text" id="relationship"></div>
                        </div>
                    </div>
                </div>

                <!-- BASIC INFO -->
                <div class="form-group" style="margin-top: 30px;">
                    <label>Name of Document Owner: <span class="required">*</span></label>
                    <div class="row-2" style="grid-template-columns: 2fr 1fr;">
                        <div style="display: flex; gap: 10px;">
                            <input type="text" id="firstName" placeholder="First Name" required>
                            <input type="text" id="middleInitial" placeholder="M.I." maxlength="2" style="width: 60px; text-align: center;">
                        </div>
                        <input type="text" id="lastName" placeholder="Last Name" required>
                    </div>
                    <div class="checkbox-group" style="margin-top: 10px;">
                        <input type="checkbox" id="pwdSenior"> <label for="pwdSenior" style="margin:0">PWD / Senior Citizen</label>
                    </div>
                </div>

                <div class="form-group">
                    <label>Position: <span class="required">*</span></label>
                    <input list="position_list" id="position" placeholder="Select or type position" required>
                    <datalist id="position_list">
                        <!-- Same list as before -->
                        <option value="Teacher I"><option value="Teacher II"><option value="Teacher III">
                        <option value="Teacher IV"><option value="Teacher V"><option value="Teacher VI">
                        <option value="Master Teacher I"><option value="Master Teacher II"><option value="Master Teacher III">
                        <option value="Master Teacher IV"><option value="Master Teacher V"><option value="Master Teacher VI">
                        <option value="Head Teacher I"><option value="Head Teacher II"><option value="Head Teacher III">
                        <option value="Head Teacher IV"><option value="Head Teacher V"><option value="Head Teacher VI">
                        <option value="Principal I"><option value="Principal II"><option value="Principal III"><option value="Principal IV">
                        <option value="Administrative Aide I"><option value="Administrative Aide II"><option value="Administrative Aide III">
                        <option value="Administrative Aide IV"><option value="Administrative Aide V"><option value="Administrative Aide VI">
                        <option value="Administrative Officer IV, Cash"><option value="Administrative Officer IV, Personnel">
                        <option value="Administrative Officer IV, Records"><option value="Administrative Officer IV, Supply">
                        <option value="Administrative Officer V"><option value="Assistant Schools Division Superintendent">
                        <option value="Chief Education Supervisor, CID"><option value="Dentist II"><option value="Education Program Supervisor">
                        <option value="Education Program Supervisor II"><option value="Engineer III"><option value="Information Technology Officer I">
                        <option value="Legal Officer III"><option value="Nurse II"><option value="Planning Officer III">
                        <option value="Project Development Officer I"><option value="Project Development Officer II">
                        <option value="Public School District Supervisor"><option value="School Governance & Operations Division Chief">
                        <option value="Schools Division Superintendent"><option value="Senior Education Program Specialist">
                        <option value="Guest"><option value="Non-Teaching Personnel">
                    </datalist>
                </div>

                <div class="form-group">
                    <label>School: <span class="required">*</span></label>
                    <input list="school_list" id="school" placeholder="Select or type school" required>
                    <datalist id="school_list">
                        <!-- Same list as before -->
                        <option value="Academia Progresiva De Manila Inc."><option value="Addition Hills IS"><option value="Amado T. Reyes Child Study Center Inc.">
                        <option value="Amado T. Reyes ES"><option value="Andres Bonifacio IS"><option value="Angeli Dei School Inc.">
                        <option value="Arellano University Plaridel Campus"><option value="Bonifacio Javier NHS"><option value="Cascades School Inc.">
                        <option value="City of Mandaluyong Science HS"><option value="Clayton Learning Center Philippines Inc."><option value="Curum Christian School">
                        <option value="Do√±a Basilisa Yangco ES"><option value="Do√±a Pilar C. Gonzaga ES"><option value="Don Bosco Technical College">
                        <option value="Esperanza Kids Castle Learning Center Inc."><option value="Eulogio Rodriguez IS"><option value="Filemon P. Javier ES">
                        <option value="Future Minds Academy of Mandaluyong Inc."><option value="Gateways Institute of Science and Technology">
                        <option value="Good Shepherd Christian School"><option value="Headstart Schools of Mandaluyong"><option value="Highway Hills IS">
                        <option value="Holistic Education Montesorri Inc."><option value="Hulo Integrated School"><option value="Hulo IS">
                        <option value="Ilaya Barangka IS"><option value="Independent Living Center"><option value="International Baptist College">
                        <option value="International Training Center and Hospitality Institute"><option value="Isaac Lopez IS"><option value="Jose Fabella MS">
                        <option value="Jose Rizal University"><option value="Keys School Manila"><option value="KIDS Integral Development through Skillful Learning">
                        <option value="Kids Center"><option value="Kites and Strings Learning Center Inc."><option value="La Salle Green Hills">
                        <option value="Lead Educational High School Inc."><option value="Little Thams Learning Center">
                        <option value="Living Stones Christian Academy Mandaluyong, Inc."><option value="Lourdes School of Mandaluyong">
                        <option value="Makati Hope Christian School Inc."><option value="Mandaluyong Addition Hills ES"><option value="Mandaluyong ES">
                        <option value="Mandaluyong HS"><option value="Maranatha Christian Academy of Mandaluyong City, Inc.">
                        <option value="Mataas na Paaralang Neptali A. Gonzales"><option value="Mulberry Learning"><option value="Nueve de Febrero ES">
                        <option value="Our Lady of Guadalupe Colleges Inc."><option value="Pedro P. Cruz ES"><option value="Plainview ES">
                        <option value="Pleasant Hills ES"><option value="Precious Saviour and Redeemer Academy"><option value="Rainbow Room Learning Center Inc.">
                        <option value="Renato Lopez ES"><option value="Rizal Technological University"><option value="Saint John Bosco Institute of Arts and Sciences Inc.">
                        <option value="San Felipe Neri Catholic School"><option value="Schools Division Office of Mandaluyong"><option value="Senate President Neptali A. Gonzales">
                        <option value="Smart Kids Learning Center"><option value="St. Anthony of Makati Montersorri School"><option value="St. Therese Private School, Inc.">
                        <option value="Urban School for Children">
                    </datalist>
                </div>

                <div class="row-2">
                    <div class="form-group"><label>Date:</label><input type="text" id="currentDate" class="readonly-field" readonly></div>
                    <div class="form-group"><label>Time:</label><input type="text" id="currentTime" class="readonly-field" readonly></div>
                </div>

                <div style="margin-bottom: 30px; padding: 15px; background: #eef; border-radius: 10px;">
                    <div class="checkbox-group">
                        <input type="checkbox" id="privacyConsent">
                        <label for="privacyConsent" style="font-size: 14px; margin:0;">I hereby authorise (Pinahihintulutan ko) the SDO Mandaluyong to collect and process the data indicated herein for the purpose of effecting control of the request slip system. I understand that my personal information is protected by RA 10173, the Data Privacy Act of 2012. <span class="required">*</span></label>
                    </div>
                </div>

                <!-- CHECKLIST SECTION -->
                <div class="section-box">
                    <h3 class="section-title">Action & Documents <span class="required">*</span></h3>
                   
                    <div class="checkbox-group">
                        <input type="checkbox" id="action-inquiry" value="Inquiry"> <label for="action-inquiry" style="margin:0; font-weight: bold;">Inquiry</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="action-request" value="Request" onchange="toggleSections()"> <label for="action-request" style="margin:0; font-weight: bold;">Request Document/Service</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="action-submission" value="Submission" onchange="toggleSections()"> <label for="action-submission" style="margin:0; font-weight: bold;">Submit Document</label>
                    </div>

                    <!-- REQUEST SECTION (Corrected Structure) -->
                    <div id="requestSection" class="hidden animate-fade-in" style="margin-top: 20px; border-top: 2px solid #4a90e2; padding-top: 20px;">
                        <h4 style="background: #4a90e2; color: white; padding: 5px 15px; border-radius: 15px; display: inline-block; margin-bottom: 15px;">Documents to REQUEST</h4>
                       
                        <div class="row-4">
                            <!-- Window 1 -->
                            <div>
                                <div class="subsection-title">Window 1</div>
                                <div id="req-w1"></div>
                                <div id="req-w1-complex"></div> 
                                
                                <!-- EXTERNAL SERVICES (Now inside Window 1 column) -->
                                <div style="margin-top: 15px; border-top: 1px dashed #ccc; padding-top: 10px;">
                                    <div class="subsection-title" style="color: #666; font-size: 14px;">External Services</div>
                                    <div id="req-external"></div>
                                </div>
                            </div>
                            
                            <!-- Window 2 -->
                            <div>
                                <div class="subsection-title">Window 2</div>
                                <div id="req-w2"></div>
                            </div>
                            
                            <!-- Window 3 -->
                            <div>
                                <div class="subsection-title">Window 3</div>
                                <div id="req-w3-gsis"></div> <!-- GSIS Complex -->
                                <div id="req-w3"></div> <!-- Pag-ibig/Philhealth -->
                            </div>
                            
                            <!-- Window 4 -->
                            <div>
                                <div class="subsection-title">Window 4</div>
                                <div id="req-w4"></div>
                            </div>
                        </div>
                    </div>

                    <!-- SUBMISSION SECTION (No External Services here) -->
                    <div id="submissionSection" class="hidden animate-fade-in" style="margin-top: 20px; border-top: 2px solid #27ae60; padding-top: 20px;">
                        <h4 style="background: #27ae60; color: white; padding: 5px 15px; border-radius: 15px; display: inline-block; margin-bottom: 15px;">Documents to SUBMIT</h4>
                       
                        <div class="row-4">
                            <!-- Window 1 -->
                            <div>
                                <div class="subsection-title green">Window 1</div>
                                <div id="sub-w1"></div>
                                <div id="sub-w1-complex"></div>
                            </div>
                            <!-- Window 2 -->
                            <div>
                                <div class="subsection-title green">Window 2</div>
                                <div id="sub-w2"></div>
                            </div>
                            <!-- Window 3 -->
                            <div>
                                <div class="subsection-title green">Window 3</div>
                                <div id="sub-w3-gsis"></div>
                                <div id="sub-w3"></div>
                            </div>
                            <!-- Window 4 -->
                            <div><div class="subsection-title green">Window 4</div><div id="sub-w4"></div></div>
                        </div>
                    </div>
                </div>

                <button type="submit" id="submitBtn" class="submit-btn">Submit Request</button>
            </form>
        </div>
       
        <!-- FOOTER -->
        <div class="footer">
            <div class="footer-content">
                <div class="footer-icon">üìç</div>
                <span class="footer-text">Highway Hills ES, Calbayog St., Mandaluyong City</span>
            </div>
        </div>
    </div>

    <!-- TIGER OVERLAYS -->
    <div class="tiger-speech-bubble" id="tigerSpeech">Press Me to Contact Us! üêæ</div>
    <div class="contact-popup" id="contactPopup">
        <button class="close-contact" onclick="closeContactPopup()">√ó</button>
        <h3>Contact Us</h3>
        <div class="contact-item"><span class="contact-icon">üìû</span><span class="contact-text"><a href="tel:0279453707">(02) 7945-3707</a></span></div>
        <div class="contact-item"><span class="contact-icon">‚úâÔ∏è</span><span class="contact-text"><a href="https://mail.google.com/mail/?view=cm&fs=1&to=sdo.mandaluyong@deped.gov.ph" target="_blank">sdo.mandaluyong@deped.gov.ph</a></span></div>
    </div>
    <div class="mascot-container">
        <div class="tiger-mascot" title="Click me for contact info!" onclick="toggleContact()"><div class="tiger-face">üêØ</div></div>
        <button class="contact-btn" id="contactBtn" onclick="toggleContact()">Contact Us</button>
    </div>

    <!-- MODALS -->
    <div id="confirmModal" class="modal">
        <div class="modal-content">
            <h2 style="color:#4a90e2; margin-bottom: 10px;">Confirm Transaction</h2>
            <p>Are you sure you want to proceed?</p>
            <div class="modal-buttons">
                <button class="modal-btn btn-cancel" onclick="closeModal('confirmModal')">Cancel</button>
                <button class="modal-btn btn-confirm" onclick="sendToFirebase()">Yes, Submit</button>
            </div>
        </div>
    </div>
    <div id="successModal" class="modal">
        <div class="modal-content">
            <h2 style="color: #27ae60; margin-bottom: 10px;">Success!</h2>
            <p>Your request has been queued.</p>
            <button class="modal-btn btn-cancel" onclick="resetForm()" style="margin-top: 20px;">OK</button>
        </div>
    </div>

    <!-- FIREBASE SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, push, set } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
        import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        
        const firebaseConfig = {
            apiKey: "AIzaSyCsAzhuOeYVynBOAPy8Kg0Z7MpTalNJhmU",
            authDomain: "hr-queuing-system.firebaseapp.com",
            databaseURL: "https://hr-queuing-system-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "hr-queuing-system",
            storageBucket: "hr-queuing-system.firebasestorage.app",
            messagingSenderId: "31106821738",
            appId: "1:31106821738:web:e3ed68d3fb29b942c22413"
        };

        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);
        const auth = getAuth(app);
        
        const loginScreen = document.getElementById('login-screen');
        const mainContainer = document.getElementById('mainContainer');
        const loginForm = document.getElementById('loginForm');
        const loginError = document.getElementById('loginError');

        onAuthStateChanged(auth, (user) => {
            if (user) {
                loginScreen.classList.add('hidden');
                mainContainer.classList.remove('hidden');
                const speech = document.getElementById('tigerSpeech');
                if(speech) {
                    setTimeout(() => speech.classList.add('show'), 1000);
                    setTimeout(() => speech.classList.remove('show'), 6000);
                }
            } else {
                loginScreen.classList.remove('hidden');
                mainContainer.classList.add('hidden');
            }
        });

        loginForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            loginError.innerText = "Verifying...";
            signInWithEmailAndPassword(auth, email, password)
                .catch((error) => { loginError.innerText = "Access Denied: " + error.message; });
        });

        window.pushDataToFirebase = function(data) {
            const dbRef = ref(database, 'queue');
            const newEntryRef = push(dbRef);
            return set(newEntryRef, data);
        };
    </script>

    <!-- FORM LOGIC -->
    <script>
        // --- HIDDEN TIMER LOGIC ---
        let formStartTime = null;
        let formHasStarted = false;
        document.addEventListener('input', function() {
            if (!formHasStarted) {
                formHasStarted = true;
                formStartTime = Date.now();
            }
        });

        // --- DATA STRUCTURE (UPDATED) ---
        const DOCS = {
            // Window 1 Standard
            w1: ["Original Appointment", "Plantilla Allocation List", "Travel Order"],
            // Window 1 Complex
            appt: ["New Appointment", "Promotion", "Reclassification", "Transfer"],
            personal: ["Resignation", "Retirement", "Maternity Leave", "Travel Abroad"],
            // Window 1 External
            ext: ["Permit to Operate Application",
"Government Recognition Application",
"Special Order (SO) Application",
"Permit Renewal Application",
"Tuition Fee Increase Application",
"SHS Voucher Program",],
            
            // Window 2
            w2: ["Service Record", "Certificate of Employment (COE)", "Form 6 (Leave)"],
            
            // Window 3
            w3: ["Pag-ibig Loan App", "PhilHealth Form"],
            gsis: ["Loan Confirmation", "Retirement Benefit", "Update Information"],
            
            // Window 4
            w4: ["Certificate of Last Payment", "Notice of Salary Adjustment", "Provident Fund", "COC / Service Credits"]
        };


        // --- RENDER FUNCTIONS ---
        function createCheckboxes(targetId, items, prefix, className = "") {
            const container = document.getElementById(targetId);
            items.forEach(item => {
                const div = document.createElement('div');
                div.className = "checkbox-row";
                const id = `${prefix}-${item.replace(/[^a-zA-Z0-9]/g, '')}`;
               
                div.innerHTML = `
                    <input type="checkbox" id="${id}" value="${item}" class="${className}">
                    <label for="${id}" class="checkbox-label">${item}</label>
                `;
                container.appendChild(div);
            });
        }

        function createComplexToggle(targetId, label, subItems, prefix, className) {
            const container = document.getElementById(targetId);
            const mainId = `${prefix}-main`;
            const subContainerId = `${prefix}-sub`;
           
            const html = `
                <div style="margin-top: 8px;">
                    <div class="checkbox-row">
                        <input type="checkbox" id="${mainId}" class="${className}-main" onchange="toggleSub('${subContainerId}', this.checked)">
                        <label for="${mainId}" class="checkbox-label" style="font-weight:bold;">${label}</label>
                    </div>
                    <div id="${subContainerId}" class="sub-container closed"></div>
                </div>
            `;
            container.innerHTML += html;
           
            setTimeout(() => {
                createCheckboxes(subContainerId, subItems, prefix, className);
            }, 0);
        }

        // --- INITIALIZATION (UPDATED FOR NEW LAYOUT) ---
        // Request Window 1
        createCheckboxes('req-w1', DOCS.w1, 'req-w1', 'req-cb');
        createComplexToggle('req-w1-complex', 'Appointment Processing', DOCS.appt, 'req-appt', 'req-cb');
        createComplexToggle('req-w1-complex', 'Personal Action', DOCS.personal, 'req-pa', 'req-cb');
        createCheckboxes('req-external', DOCS.ext, 'req-ext', 'req-cb'); // External inside W1 (Request only)

        // Request Other Windows
        createCheckboxes('req-w2', DOCS.w2, 'req-w2', 'req-cb');
        createComplexToggle('req-w3-gsis', 'GSIS Concern', DOCS.gsis, 'req-gsis', 'req-cb');
        createCheckboxes('req-w3', DOCS.w3, 'req-w3', 'req-cb');
        createCheckboxes('req-w4', DOCS.w4, 'req-w4', 'req-cb');
       
        // Submission (No External)
        createCheckboxes('sub-w1', DOCS.w1, 'sub-w1', 'sub-cb');
        createComplexToggle('sub-w1-complex', 'Appointment Processing', DOCS.appt, 'sub-appt', 'sub-cb');
        createComplexToggle('sub-w1-complex', 'Personal Action', DOCS.personal, 'sub-pa', 'sub-cb');
        createCheckboxes('sub-w2', DOCS.w2, 'sub-w2', 'sub-cb');
        createComplexToggle('sub-w3-gsis', 'GSIS Concern', DOCS.gsis, 'sub-gsis', 'sub-cb');
        createCheckboxes('sub-w3', DOCS.w3, 'sub-w3', 'sub-cb');
        createCheckboxes('sub-w4', DOCS.w4, 'sub-w4', 'sub-cb');


        // --- TIME ---
        function updateDateTime() {
            const now = new Date();
            document.getElementById('currentDate').value = now.toLocaleDateString('en-US');
            document.getElementById('currentTime').value = now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
        }
        setInterval(updateDateTime, 1000);
        updateDateTime();

        // --- INTERACTIVITY ---
        function toggleRepresentative(isRep) {
            const fields = document.getElementById('representativeFields');
            isRep ? fields.classList.remove('hidden') : fields.classList.add('hidden');
        }

        function toggleSections() {
            const isReq = document.getElementById('action-request').checked;
            const isSub = document.getElementById('action-submission').checked;
            const reqSec = document.getElementById('requestSection');
            const subSec = document.getElementById('submissionSection');
            isReq ? reqSec.classList.remove('hidden') : reqSec.classList.add('hidden');
            isSub ? subSec.classList.remove('hidden') : subSec.classList.add('hidden');
        }

        function toggleSub(id, checked) {
            const el = document.getElementById(id);
            if(checked) {
                el.classList.remove('closed');
                el.classList.add('open');
            } else {
                el.classList.remove('open');
                el.classList.add('closed');
                el.querySelectorAll('input').forEach(i => i.checked = false);
            }
        }

        function closeModal(id) { document.getElementById(id).classList.remove('active'); }
        function openModal(id) { document.getElementById(id).classList.add('active'); }

        function resetForm() {
            document.getElementById('requestForm').reset();
            toggleSections();
            toggleRepresentative(false);
            document.querySelectorAll('.sub-container').forEach(el => {
                el.classList.remove('open');
                el.classList.add('closed');
            });
            formHasStarted = false;
            formStartTime = null;
            closeModal('successModal');
        }

        // --- MASCOT FUNCTIONS ---
        function toggleContact() {
            const popup = document.getElementById('contactPopup');
            const speech = document.getElementById('tigerSpeech');
            popup.classList.toggle('show');
            if(popup.classList.contains('show')) speech.classList.remove('show');
        }
        function closeContactPopup() { document.getElementById('contactPopup').classList.remove('show'); }


        // --- SUBMISSION ---
        document.getElementById('requestForm').addEventListener('submit', function(e) {
            e.preventDefault();
            function isValueInDatalist(inputId, datalistId) {
                const input = document.getElementById(inputId);
                const list = document.getElementById(datalistId);
                const options = Array.from(list.options).map(opt => opt.value);
                return options.includes(input.value);
            }
            if (!isValueInDatalist('position', 'position_list')) {
                alert("Please select a valid Position from the provided list.");
                document.getElementById('position').value = ""; document.getElementById('position').focus(); return;
            }
            if (!isValueInDatalist('school', 'school_list')) {
                alert("Please select a valid School from the provided list.");
                document.getElementById('school').value = ""; document.getElementById('school').focus(); return;
            }
            if(!document.getElementById('privacyConsent').checked) { alert("Please agree to privacy consent."); return; }
            if(!document.getElementById('action-inquiry').checked && !document.getElementById('action-request').checked && !document.getElementById('action-submission').checked) {
                alert("Please select a transaction type."); return;
            }
            openModal('confirmModal');
        });

        async function sendToFirebase() {
            closeModal('confirmModal');
            const btn = document.getElementById('submitBtn');
            const originalText = btn.innerHTML;
            btn.innerHTML = "Processing...";
            btn.disabled = true;

            const formEndTime = Date.now();
            let durationString = "0:00";
            if (formStartTime) {
                const durationMs = formEndTime - formStartTime;
                const minutes = Math.floor(durationMs / 60000);
                const seconds = ((durationMs % 60000) / 1000).toFixed(0);
                durationString = minutes + ":" + (seconds < 10 ? '0' : '') + seconds;
            } else { durationString = "0:01"; }

            // PASTE YOUR WEB APP URL HERE
            const googleScriptURL = "https://script.google.com/macros/s/AKfycbzXZ9rOzkl4AnuSlj3vdfRujMc9UZeojz4qlpx0quqtXakQOC6N626jUkYCCGgrRfGavg/exec";

            const data = {
                firstName: document.getElementById('firstName').value,
                middleInitial: document.getElementById('middleInitial').value,
                lastName: document.getElementById('lastName').value,
                school: document.getElementById('school').value,
                position: document.getElementById('position').value,
                date: document.getElementById('currentDate').value,
                time: document.getElementById('currentTime').value,
                isPwd: document.getElementById('pwdSenior').checked,
                isRepresentative: document.querySelector('input[name="transactionType"]:checked').value === 'representative',
                repName: document.getElementById('representativeName').value,
                relationship: document.getElementById('relationship').value,
                timestamp: Date.now(),
                status: "waiting",
                fillDuration: durationString
            };

            const fullName = `${data.firstName} ${data.lastName}`;
            let actionItems = [];

            if(document.getElementById('action-inquiry').checked) actionItems.push("INQUIRY: General Inquiry");

            if(document.getElementById('action-request').checked) {
                document.querySelectorAll('.req-cb:checked').forEach(cb => actionItems.push(`REQUEST: ${cb.value}`));
                ['req-gsis-main', 'req-appt-main', 'req-pa-main'].forEach(id => {
                    const cb = document.getElementById(id);
                    if(cb && cb.checked) {
                        const subId = id.replace('-main', '-sub');
                        if(document.querySelectorAll(`#${subId} input:checked`).length === 0) {
                            actionItems.push(`REQUEST: ${cb.nextElementSibling.innerText} (General)`);
                        }
                    }
                });
            }

            if(document.getElementById('action-submission').checked) {
                document.querySelectorAll('.sub-cb:checked').forEach(cb => actionItems.push(`SUBMIT: ${cb.value}`));
                ['sub-gsis-main', 'sub-appt-main', 'sub-pa-main'].forEach(id => {
                    const cb = document.getElementById(id);
                    if(cb && cb.checked) {
                        const subId = id.replace('-main', '-sub');
                        if(document.querySelectorAll(`#${subId} input:checked`).length === 0) {
                            actionItems.push(`SUBMIT: ${cb.nextElementSibling.innerText} (General)`);
                        }
                    }
                });
            }

            data.documents = actionItems.join(', ');
            data.name = fullName;

            const formPayload = new FormData();
            formPayload.append('firstName', data.firstName);
            formPayload.append('middleInitial', data.middleInitial);
            formPayload.append('lastName', data.lastName);
            formPayload.append('position', data.position);
            formPayload.append('school', data.school);
            formPayload.append('date', data.date);
            formPayload.append('time', data.time);
            formPayload.append('documents', data.documents);
            formPayload.append('isPwd', data.isPwd);
            formPayload.append('isRepresentative', data.isRepresentative);
            formPayload.append('repName', data.repName);
            formPayload.append('relationship', data.relationship);
            formPayload.append('fillDuration', durationString);

            if (googleScriptURL && googleScriptURL !== "PASTE_YOUR_GOOGLE_SCRIPT_WEB_APP_URL_HERE") {
                fetch(googleScriptURL, { method: 'POST', body: formPayload, mode: 'no-cors' })
                .catch(err => console.error('Error sending to Google Sheet:', err));
            }

            try {
                if(window.pushDataToFirebase) { await window.pushDataToFirebase(data); }
                openModal('successModal');
            } catch (error) {
                console.error("Error:", error);
                alert("Failed to submit.");
            } finally {
                btn.innerHTML = originalText;
                btn.disabled = false;
            }
            
        }
    </script>
</body>
</html>
